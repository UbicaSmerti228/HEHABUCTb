<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>НЕНАВИСТЬ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap');
        
        body, html {
            background-color: #ffffff;
            color: #000000;
            font-family: 'Oswald', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: background-color 0.05s, opacity 2s ease-in-out;
            cursor: none; 
        }

        /* --- СУБЛИМИНАЛЬНЫЙ СЛОЙ (25-й кадр) --- */
        #subliminal-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: url('https://grainy-gradients.vercel.app/noise.svg');
            background-color: #000;
            z-index: 9000;
            display: none; /* Скрыт по умолчанию */
            align-items: center;
            justify-content: center;
            pointer-events: none;
            mix-blend-mode: hard-light;
        }
        .subliminal-text {
            color: red;
            font-size: 20vw;
            font-weight: 900;
            text-transform: uppercase;
            transform: scaleY(1.5);
            text-shadow: 10px 0 0 blue, -10px 0 0 lime;
            animation: shake-hard 0.1s infinite;
        }

        /* Кастомный курсор */
        #custom-cursor {
            position: fixed;
            width: 20px; 
            height: 20px;
            border: 2px solid #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: difference;
        }
        #custom-cursor::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 4px; height: 4px;
            background: red;
            transform: translate(-50%, -50%);
        }

        /* Фантомные курсоры */
        .phantom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9990;
            opacity: 0.6;
            mix-blend-mode: multiply;
        }
        .phantom-cursor:nth-child(2) { border-color: rgba(0, 0, 255, 0.5); width: 25px; height: 25px; }
        .phantom-cursor:nth-child(3) { border-color: rgba(0, 255, 0, 0.5); width: 15px; height: 15px; }

        .pointer-none { pointer-events: none; }

        .bullet-hole {
            position: fixed;
            width: 25px;
            height: 25px;
            background: #000;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            box-shadow: inset 0 0 8px #333;
        }
        
        .bullet-crack {
            position: fixed;
            width: 40px;
            height: 40px;
            border: 1px solid rgba(0,0,0,0.15);
            pointer-events: none;
            z-index: 99;
            transform: translate(-50%, -50%);
            border-radius: 40% 60% 70% 30% / 50% 30% 70% 50%;
            filter: blur(1px);
        }

        .blood-splatter {
            position: fixed;
            background: #880000;
            pointer-events: none;
            z-index: 98;
            transform: translate(-50%, -50%);
            opacity: 0.8;
            filter: blur(2px);
        }

        .target {
            position: fixed;
            width: 60px;
            height: 60px;
            border: 4px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            cursor: none;
            animation: target-appear 0.3s ease-out;
        }
        .target::after {
            content: '';
            width: 20px;
            height: 20px;
            background: #000;
            border-radius: 50%;
        }
        @keyframes target-appear {
            from { transform: scale(0) rotate(180deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }

        #white-noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5000;
            display: none;
            opacity: 1;
            pointer-events: all;
            background: #000;
        }
        #white-noise::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://grainy-gradients.vercel.app/noise.svg'); 
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            animation: noise-wave 0.5s infinite; 
        }

        @keyframes noise-wave {
            0% { transform: translateY(0); filter: contrast(100%); }
            50% { transform: translateY(-5px); filter: contrast(150%) hue-rotate(90deg); }
            100% { transform: translateY(0); }
        }

        #screamer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #ff0000;
            display: none;
            z-index: 1000;
            align-items: center; justify-content: center;
            flex-direction: column;
            pointer-events: none;
        }
        #easter-egg-image {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            opacity: 0.4;
            mix-blend-mode: multiply;
            filter: grayscale(100%) contrast(150%);
            display: none;
            z-index: 1001;
        }
        .screamer-msg {
            font-size: 35vw;
            color: #000;
            font-weight: 900;
            line-height: 0.8;
            animation: shake-hard 0.04s infinite;
            position: relative;
            z-index: 1010;
        }
        .laugh-smile {
            position: absolute;
            color: #000;
            font-weight: 900;
            font-family: 'Arial', sans-serif;
            pointer-events: none;
            z-index: 1050;
            filter: blur(1px);
            animation: smile-flicker 0.1s infinite;
        }
        .smile-drop {
            position: fixed;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #000;
            z-index: 1500;
            pointer-events: none;
            user-select: none;
            font-size: 2rem;
            white-space: nowrap;
        }

        @keyframes smile-flicker {
            0% { opacity: 1; transform: scale(1) rotate(5deg); }
            50% { opacity: 0.7; transform: scale(1.2) rotate(-5deg); }
            100% { opacity: 1; transform: scale(1.1) rotate(0deg); }
        }

        @keyframes shake-hard {
            0% { transform: translate(15px, 15px); filter: invert(0); }
            50% { transform: translate(-15px, -15px); filter: invert(1); }
            100% { transform: translate(20px, -10px); }
        }
        .screen-shake { animation: s-shake-heavy 0.15s infinite; }
        @keyframes s-shake-heavy {
            0% { transform: translate(5px, 3px) rotate(0.5deg); }
            50% { transform: translate(-5px, -3px) rotate(-0.5deg); }
            100% { transform: translate(3px, -5px) rotate(0.2deg); }
        }

        .vignette { position: fixed; top: 0; left: 0; width: 100%; height: 100%; box-shadow: inset 0 0 250px rgba(0,0,0,0.8); z-index: 35; pointer-events: none; }
        .vhs-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 30; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05)); background-size: 100% 4px, 4px 100%; }
        .vhs-lines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(18, 16, 16, 0); opacity: 0.2; z-index: 31; animation: scanline 4s linear infinite; }
        @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        .burn { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 60%, rgba(0,0,0,0.9) 100%); z-index: 36; mix-blend-mode: multiply; opacity: 0; transition: opacity 0.1s; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://grainy-gradients.vercel.app/noise.svg'); opacity: 0.2; z-index: 20; pointer-events: none; }

        .main-text {
            font-size: clamp(5rem, 25vw, 25rem);
            font-weight: 700;
            line-height: 0.75;
            letter-spacing: -0.07em;
            text-transform: uppercase;
            transform: scaleX(0.8);
            text-align: center;
            user-select: none;
            z-index: 100;
            position: relative;
            filter: blur(0.5px);
            text-shadow: 15px 15px 0px rgba(0,0,0,0.2);
            transition: color 0.3s ease; 
            pointer-events: auto !important;
        }
        .main-text::before, .main-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.6; z-index: -1;
        }
        .rgb-split .main-text::before {
            color: #ff0000;
            transform: translateX(-5px) skewX(2deg);
            animation: glitch-anim 0.1s infinite;
        }
        .rgb-split .main-text::after {
            color: #0000ff;
            transform: translateX(5px) skewX(-2deg);
            animation: glitch-anim-2 0.1s infinite alternate;
        }
        @keyframes glitch-anim { 0% { clip-path: inset(10% 0 30% 0); } 50% { clip-path: inset(80% 0 5% 0); } 100% { clip-path: inset(20% 0 50% 0); } }
        @keyframes glitch-anim-2 { 0% { clip-path: inset(40% 0 10% 0); } 50% { clip-path: inset(5% 0 85% 0); } 100% { clip-path: inset(60% 0 20% 0); } }

        .ui-element { position: absolute; font-family: 'Courier New', Courier, monospace; color: inherit; font-weight: bold; text-transform: uppercase; z-index: 40; opacity: 0.8; }
        .rec { top: 30px; right: 40px; display: flex; align-items: center; gap: 8px; font-size: clamp(1rem, 3vw, 1.8rem); }
        .score-ui { top: 30px; left: 40px; font-size: clamp(1rem, 3vw, 1.8rem); color: #000; }
        .rec-text { color: #ff0000; }
        .dot { width: 14px; height: 14px; background-color: #ff0000; border-radius: 50%; animation: blink 0.5s steps(2) infinite; }
        .timer { bottom: 30px; left: 40px; font-size: clamp(1rem, 3vw, 1.8rem); cursor: none; transition: color 0.2s; }
        .timer:hover { color: #ff0000; }
        
        .whisper { position: fixed; font-size: 0.8rem; color: rgba(0,0,0,0.5); font-family: 'Courier New', monospace; z-index: 5; pointer-events: none; text-transform: uppercase; }
        .glitch-word { position: fixed; font-size: clamp(2rem, 12vw, 10rem); font-weight: 900; color: black; text-transform: uppercase; z-index: 25; pointer-events: none; transform: scaleX(0.8); font-family: 'Oswald', sans-serif; background: white; padding: 0 15px; box-shadow: 10px 10px 0px black; }

        body.inverted { background-color: #000000 !important; color: #ffffff !important; }
        body.inverted .vhs-overlay, body.inverted .vhs-lines, body.inverted .overlay, body.inverted .vignette, body.inverted .whisper, body.inverted .score-ui { filter: invert(1); }
        body.inverted .glitch-word { background: black; color: white; box-shadow: 10px 10px 0px white; }
        body.inverted .main-text { text-shadow: 15px 15px 0px rgba(255,255,255,0.1); }
        body.inverted .bullet-hole { background: #fff; }
        body.inverted .bullet-crack { border-color: rgba(255,255,255,0.2); }
        body.inverted .target { border-color: #fff; }
        body.inverted .target::after { background: #fff; }
        body.inverted #custom-cursor { border-color: #fff; }

        .distort { filter: hue-rotate(180deg) contrast(300%) brightness(50%) invert(1); }

        .final-text-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 1000px;
            color: #ffffff;
            text-align: center;
            z-index: 6000;
            font-family: 'Courier New', monospace;
            font-size: clamp(0.9rem, 2vw, 1.5rem);
            line-height: 1.8;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 1s ease-in;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            pointer-events: none;
        }
        .show-final-text {
            opacity: 1;
        }
        .typing-cursor::after {
            content: '█';
            animation: blink-cursor 0.5s infinite;
            margin-left: 2px;
        }
        @keyframes blink-cursor { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
    </style>
</head>
<body onmousedown="this.classList.add('inverted')" onmouseup="this.classList.remove('inverted')" ontouchstart="this.classList.add('inverted')" ontouchend="this.classList.remove('inverted')">
    
    <div id="subliminal-layer">
        <div class="subliminal-text">ЗАЧЕМ?</div>
    </div>

    <div id="custom-cursor"></div>
    <div class="phantom-cursor" id="p-cursor-1"></div>
    <div class="phantom-cursor" id="p-cursor-2"></div>
    <div class="phantom-cursor" id="p-cursor-3"></div>

    <div id="white-noise"></div>
    <div id="final-message-container" class="final-text-overlay"></div>

    <div id="screamer">
        <img id="easter-egg-image" src="image_8fe36a.jpg" alt="easter egg">
        <div class="screamer-msg">НЕТ</div>
        <div id="laugh-container" style="position:absolute; width:100%; height:100%;"></div>
    </div>

    <div class="burn" id="burn-effect"></div>
    <div class="vignette pointer-none"></div>
    <div class="vhs-overlay pointer-none"></div>
    <div class="vhs-lines pointer-none"></div>
    <div class="overlay pointer-none"></div>

    <div class="ui-element rec pointer-none">
        <div class="dot"></div>
        <span class="rec-text">ЗАПИСЬ</span>
    </div>

    <div class="ui-element score-ui" id="score-display">ПОПАДАНИЙ: 00/20</div>

    <h1 class="main-text" id="main-title" data-text="НЕНАВИСТЬ">НЕНАВИСТЬ</h1>

    <div class="ui-element timer" id="countdown">00:00:00</div>
    <div id="glitch-container"></div>

    <script>
        let timeLeft = 61818; 
        let isPaused = false;
        let hits = 0;
        let maxHits = 20;
        let isFinalPhase = false;
        let laughInterval;
        
        // Фантомные курсоры
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;
        let cursorX = mouseX, cursorY = mouseY;
        let p1x = mouseX, p1y = mouseY;
        let p2x = mouseX, p2y = mouseY;
        let p3x = mouseX, p3y = mouseY;
        let evasionX = 0;
        let evasionY = 0;

        // Аудио контекст
        let audioCtx;
        let noiseNode; // Для белого шума
        let noiseGain;

        const words = ["БЕССМЫСЛЕННОСТЬ", "ГНИЕНИЕ", "ТУПИК", "НИЧТО", "УДУШЬЕ", "МРАК", "ПРЕДАТЕЛЬСТВО", "ЗАБВЕНИЕ", "БОЛЬ", "КОНЕЦ", "НЕНАВИСТЬ", "СМЫСЛ?", "ПОЧЕМУ", "ПРЕДАТЕЛЬСТВО"];
        const whispers = ["помоги мне", "зачем ты здесь?", "уходи", "все кончено", "ты один", "никому не нужен", "смерть близко", "нажми", "умри", "выход есть?"];
        const tips = ["СТРЕЛЯЙ ЕЩЕ", "МАЛО КРОВИ", "НЕ ОСТАНАВЛИВАЙСЯ", "БОЛЬШЕ ПУЛЬ", "НУЖНО БОЛЬШЕ"];
        const consoleLogs = [
            "SYSTEM FAILURE: Emotional dampeners offline.",
            "WARNING: Subject heart rate exceeding safe limits.",
            "CRITICAL: Reality anchor detached.",
            "LOG: Who is watching you?",
            "ERROR: Soul not found.",
            "SYSTEM: Initiating purge sequence..."
        ];

        // --- ДИНАМИЧЕСКИЙ ЗАГОЛОВОК (Idea 4) ---
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                document.title = "ПОЧЕМУ";
            } else {
                document.title = isFinalPhase ? "ТЫ" : "НЕНАВИСТЬ";
            }
        });

        // --- СУБЛИМИНАЛЬНЫЙ КАДР (Idea 2) ---
        function triggerSubliminalFrame() {
            if(isPaused) return;
            const layer = document.getElementById('subliminal-layer');
            layer.style.display = 'flex';
            
            // Короткий звук глитча
            playGlitchSound(); 

            // Скрываем очень быстро (3-4 кадра при 60fps)
            setTimeout(() => {
                layer.style.display = 'none';
            }, 60);

            // Следующий триггер через случайное время (от 15 до 40 секунд)
            const nextTime = Math.random() * 25000 + 15000; 
            setTimeout(triggerSubliminalFrame, nextTime);
        }
        // Запуск цикла сублиминальных кадров через 10 секунд после старта
        setTimeout(triggerSubliminalFrame, 10000);

        // --- АУДИО СИСТЕМА (Монотонный белый шум) ---
        function initAudio() {
            if (audioCtx) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();

            // Создание буфера белого шума
            const bufferSize = audioCtx.sampleRate * 2; // 2 секунды буфера
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1; // Заполняем случайными значениями
            }

            noiseNode = audioCtx.createBufferSource();
            noiseNode.buffer = buffer;
            noiseNode.loop = true;

            // Фильтр для смягчения шума (чтобы не резал уши высокими частотами)
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1000;

            noiseGain = audioCtx.createGain();
            noiseGain.gain.value = 0.05; // Тихий уровень громкости

            noiseNode.connect(filter);
            filter.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            
            noiseNode.start();
        }

        function playShotSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.type = 'square';
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playGlitchSound(isTyping = false) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            // Для печати звук выше и короче
            const freq = isTyping ? 800 + Math.random() * 500 : 100 + Math.random() * 200;
            const duration = isTyping ? 0.05 : 0.1;

            osc.type = Math.random() > 0.5 ? 'sawtooth' : 'square';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            if (!isTyping) {
                osc.frequency.linearRampToValueAtTime(freq + 500, audioCtx.currentTime + duration);
            }
            
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- КОНСОЛЬНЫЕ СООБЩЕНИЯ ---
        function triggerCreepyConsole() {
            const msg = consoleLogs[Math.floor(Math.random() * consoleLogs.length)];
            const style = "background: #000; color: #ff0000; font-size: 14px; font-family: monospace; padding: 2px 5px;";
            console.log(`%c${msg}`, style);
            if (Math.random() > 0.8) console.clear();
        }
        setInterval(triggerCreepyConsole, 5000);


        // --- ОБРАБОТЧИКИ МЫШИ И КУРСОРЫ ---
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        // Анимация фантомных курсоров (Loop)
        function animateCursors() {
            // Основной кастомный курсор без задержки
            const mainCursor = document.getElementById('custom-cursor');
            mainCursor.style.left = mouseX + 'px';
            mainCursor.style.top = mouseY + 'px';

            // Фантомы с задержкой (Lerp)
            p1x += (mouseX - p1x) * 0.15;
            p1y += (mouseY - p1y) * 0.15;
            document.getElementById('p-cursor-1').style.left = p1x + 'px';
            document.getElementById('p-cursor-1').style.top = p1y + 'px';

            p2x += (mouseX - p2x) * 0.1;
            p2y += (mouseY - p2y) * 0.1;
            document.getElementById('p-cursor-2').style.left = p2x + 'px';
            document.getElementById('p-cursor-2').style.top = p2y + 'px';

            p3x += (mouseX - p3x) * 0.05;
            p3y += (mouseY - p3y) * 0.05;
            document.getElementById('p-cursor-3').style.left = p3x + 'px';
            document.getElementById('p-cursor-3').style.top = p3y + 'px';

            requestAnimationFrame(animateCursors);
        }
        animateCursors();


        document.addEventListener('mousedown', function(e) {
            // Инициализация звука при первом клике (белый шум вместо дрона)
            initAudio();
            playShotSound();

            if (isPaused || e.target.id === 'countdown') return;

            if (isFinalPhase && (e.target.id === 'main-title' || e.target.closest('#main-title'))) {
                triggerFinalNoise();
                return;
            }

            const x = e.clientX;
            const y = e.clientY;

            const target = e.target.closest('.target');
            
            if (target) {
                hits++;
                document.getElementById('score-display').innerText = `ПОПАДАНИЙ: ${String(hits).padStart(2, '0')}/20`;
                createBulletHole(x, y, true); 
                target.remove();
                
                if (hits >= maxHits) {
                    startFinalPhase();
                } else {
                    setTimeout(spawnTarget, 400);
                }
            } else {
                createBulletHole(x, y, false);
                
                if(!isFinalPhase && Math.random() > 0.8) {
                    const scoreDisp = document.getElementById('score-display');
                    const originalText = `ПОПАДАНИЙ: ${String(hits).padStart(2, '0')}/20`;
                    scoreDisp.innerText = tips[Math.floor(Math.random()*tips.length)];
                    setTimeout(() => { scoreDisp.innerText = originalText; }, 500);
                }
            }
        });

        function createBulletHole(x, y, isBlood = false) {
            const container = document.body;
            
            if (isBlood) {
                const splatter = document.createElement('div');
                splatter.className = 'blood-splatter';
                const size = 60 + Math.random() * 40;
                splatter.style.width = size + 'px';
                splatter.style.height = size + 'px';
                splatter.style.left = x + 'px';
                splatter.style.top = y + 'px';
                
                let points = "";
                for(let i=0; i<15; i++) {
                    let r = 30 + Math.random() * 40;
                    let angle = (i / 15) * Math.PI * 2;
                    let px = 50 + Math.cos(angle) * r;
                    let py = 50 + Math.sin(angle) * r;
                    points += `${px}% ${py}%, `;
                }
                splatter.style.clipPath = `polygon(${points.slice(0, -2)})`;
                container.appendChild(splatter);
                setTimeout(() => {
                    splatter.style.transition = "opacity 1s";
                    splatter.style.opacity = "0";
                    setTimeout(() => splatter.remove(), 1000);
                }, 2000);
            }

            const hole = document.createElement('div');
            hole.className = 'bullet-hole';
            hole.style.left = x + 'px';
            hole.style.top = y + 'px';
            hole.style.zIndex = "100";
            
            let points = "";
            for(let i=0; i<12; i++) {
                let r = 40 + Math.random() * 20;
                let angle = (i / 12) * Math.PI * 2;
                let px = 50 + Math.cos(angle) * r;
                let py = 50 + Math.sin(angle) * r;
                points += `${px}% ${py}%, `;
            }
            hole.style.clipPath = `polygon(${points.slice(0, -2)})`;
            hole.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 360}deg)`;
            
            const crack = document.createElement('div');
            crack.className = 'bullet-crack';
            crack.style.left = x + 'px';
            crack.style.top = y + 'px';
            crack.style.zIndex = "99";
            crack.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 360}deg) scale(${0.8 + Math.random()})`;

            container.appendChild(crack);
            container.appendChild(hole);

            setTimeout(() => {
                hole.style.transition = crack.style.transition = "opacity 1s";
                hole.style.opacity = crack.style.opacity = "0";
                setTimeout(() => { hole.remove(); crack.remove(); }, 1000);
            }, 4000);
        }

        function spawnTarget() {
            if (isPaused || isFinalPhase) return;
            document.querySelectorAll('.target').forEach(t => t.remove());

            const target = document.createElement('div');
            target.className = 'target';
            target.style.zIndex = "200"; 
            
            let x, y;
            const side = Math.random() > 0.5;
            if(side) {
                x = Math.random() * 20 + (Math.random() > 0.5 ? 5 : 75); 
                y = Math.random() * 70 + 15;
            } else {
                x = Math.random() * 70 + 15;
                y = Math.random() * 15 + (Math.random() > 0.5 ? 5 : 80); 
            }
            
            target.style.left = x + 'vw';
            target.style.top = y + 'vh';
            document.body.appendChild(target);
        }

        function startFinalPhase() {
            isFinalPhase = true;
            const title = document.getElementById('main-title');
            title.innerText = "ТЫ";
            document.title = "ТЫ";
            title.setAttribute('data-text', "ТЫ");
            title.style.color = "#ff0000";
            title.style.cursor = "none";
            document.getElementById('score-display').innerText = "УБЕЙ СЕБЯ";
            
            // Немного усиливаем шум в финале
            if (noiseGain) {
                noiseGain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 5);
            }
        }

        async function triggerFinalNoise() {
            const noise = document.getElementById('white-noise');
            const container = document.getElementById('final-message-container');
            
            // Выключаем шум для звенящей тишины перед текстом (или можно оставить)
            // Но лучше оставить для атмосферы
            
            noise.style.display = 'block'; 
            document.body.style.filter = 'grayscale(0)';
            
            document.getElementById('main-title').style.display = 'none';
            document.getElementById('score-display').style.display = 'none';
            document.getElementById('countdown').style.display = 'none';
            document.querySelectorAll('.ui-element').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.bullet-hole, .bullet-crack, .target, .blood-splatter').forEach(el => el.remove());

            container.innerHTML = "";
            container.classList.add('show-final-text');
            container.classList.add('typing-cursor');

            const textSegments = [
                { text: "ПРИГОВОР ВЫНЕСЕН. ОБЖАЛОВАНИЮ НЕ ПОДЛЕЖИТ.", type: "p" },
                { text: "<br><br>", type: "html" },
                { text: "ТВОЙ ПОСТУПОК — НЕ СИЛА, А ПОЛНЫЙ КРАХ ДУШИ. ДВАДЦАТЬ ЖИЗНЕЙ СТАНУТ ТВОИМ ВЕЧНЫМ КОНВОЕМ. ТИШИНА, КОТОРУЮ ТЫ СОЗДАЛ, БУДЕТ КРИЧАТЬ В ТВОИХ УШАХ ДО КОНЦА ВРЕМЕН.", type: "p" },
                { text: "<br><br>", type: "html" },
                { text: "ДЛЯ ТЕБЯ НЕТ НИ ПРОЩЕНИЯ, НИ ЗАБВЕНИЯ. ТЫ БОЛЬШЕ НЕ ПРИНАДЛЕЖИШЬ МИРУ ЖИВЫХ, НО И СМЕРТЬ НЕ СТАНЕТ УБЕЖИЩЕМ.", type: "p" },
                { text: "<br><br>", type: "html" },
                { text: "СМОТРИ В БЕЗДНУ. ОНА УЖЕ ЗДЕСЬ.", type: "p" },
                { text: "<br><br><br>", type: "html" },
                { 
                    text: "КАЖДЫЙ «ЧЕЛОВЕК» ОТВЕТИТ ЗА СВОИ ПОСТУПКИ", 
                    type: "span", 
                    style: "font-size: 1.2em; color: white; text-shadow: 0 0 10px #fff; font-weight: bold;" 
                }
            ];

            const triggerKeySound = () => {
                // Вызов звука глитча/печати
                playGlitchSound(true);

                const rnd = Math.random();
                if (rnd > 0.5) {
                    container.style.transform = `translate(-50%, -50%) translate(${Math.random()*4-2}px, ${Math.random()*4-2}px)`;
                }
                if (rnd > 0.8) {
                    document.body.classList.add('inverted');
                    setTimeout(() => document.body.classList.remove('inverted'), 30);
                }
            };

            for (let segment of textSegments) {
                if (segment.type === 'html') {
                    container.innerHTML += segment.text;
                } else if (segment.type === 'span') {
                    const span = document.createElement('span');
                    span.style.cssText = segment.style;
                    container.appendChild(span);
                    for (let char of segment.text) {
                        span.innerHTML += char;
                        triggerKeySound();
                        await new Promise(r => setTimeout(r, 60));
                    }
                } else {
                    for (let char of segment.text) {
                        container.innerHTML += char;
                        triggerKeySound();
                        await new Promise(r => setTimeout(r, 50));
                    }
                }
            }
            container.classList.remove('typing-cursor');
        }

        setTimeout(spawnTarget, 2000);

        function updateCountdown() {
            if (isPaused) return;
            const h = String(Math.floor(timeLeft / 3600)).padStart(2, '0');
            const m = String(Math.floor((timeLeft % 3600) / 60)).padStart(2, '0');
            const s = String(timeLeft % 60).padStart(2, '0');
            document.getElementById('countdown').innerText = `${h}:${m}:${s}`;
            if (timeLeft > 0) timeLeft--;
        }
        setInterval(updateCountdown, 1000);

        function spawnLaugh() {
            const container = document.getElementById('laugh-container');
            const smile = document.createElement('div');
            smile.className = 'laugh-smile';
            smile.innerText = ")".repeat(Math.floor(Math.random() * 8) + 4);
            smile.style.fontSize = Math.random() * 15 + 5 + "rem";
            smile.style.left = Math.random() * 90 + "vw";
            smile.style.top = Math.random() * 90 + "vh";
            container.appendChild(smile);
            setTimeout(() => smile.remove(), 100);
        }

        function spawnSmiles() {
            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    const smile = document.createElement('div');
                    smile.className = 'smile-drop';
                    smile.innerText = ")".repeat(Math.floor(Math.random() * 10) + 3);
                    smile.style.left = Math.random() * 100 + "vw";
                    smile.style.top = Math.random() * 100 + "vh";
                    document.body.appendChild(smile);
                    setTimeout(() => smile.remove(), 800);
                }, i * 20);
            }
        }

        document.getElementById('countdown').addEventListener('click', (e) => {
            e.stopPropagation(); 
            if (isPaused) return;
            const title = document.getElementById('main-title');
            const screamer = document.getElementById('screamer');
            const eggImg = document.getElementById('easter-egg-image');
            isPaused = true;
            
            title.innerText = "ВЫХОД ЕСТЬ?";
            title.setAttribute('data-text', "ВЫХОД ЕСТЬ?");
            title.style.color = "#00ff41"; 
            
            setTimeout(() => {
                screamer.style.display = 'flex';
                eggImg.style.display = 'block';
                document.body.classList.add('screen-shake');
                laughInterval = setInterval(spawnLaugh, 50);
                setTimeout(() => {
                    clearInterval(laughInterval);
                    document.getElementById('laugh-container').innerHTML = '';
                    screamer.style.display = 'none';
                    eggImg.style.display = 'none';
                    document.body.classList.remove('screen-shake');
                    
                    if (isFinalPhase) {
                        title.innerText = "ТЫ";
                        title.setAttribute('data-text', "ТЫ");
                        title.style.color = "#ff0000";
                    } else {
                        title.innerText = "НЕНАВИСТЬ";
                        title.setAttribute('data-text', "НЕНАВИСТЬ");
                        title.style.color = "";
                    }
                    
                    isPaused = false;
                    spawnSmiles();
                }, 1100);
            }, 2000);
        });

        function spawnWord() {
            const container = document.getElementById('glitch-container');
            const wordEl = document.createElement('div');
            wordEl.className = 'glitch-word';
            wordEl.innerText = words[Math.floor(Math.random() * words.length)];
            wordEl.style.left = (Math.random() * 50 + 10) + 'vw';
            wordEl.style.top = (Math.random() * 60 + 20) + 'vh';
            container.appendChild(wordEl);
            setTimeout(() => wordEl.remove(), 80);
      // playGlitchSound();//
        }

        function spawnWhisper() {
            const w = document.createElement('div');
            w.className = 'whisper';
            w.innerText = whispers[Math.floor(Math.random() * whispers.length)];
            w.style.left = Math.random() * 90 + 'vw';
            w.style.top = Math.random() * 90 + 'vh';
            document.body.appendChild(w);
            setTimeout(() => w.remove(), 1000);
        }

        setInterval(() => {
            const rnd = Math.random();
            if (isPaused) return;
            if (rnd > 0.85) spawnWord();
            if (rnd > 0.92) spawnWhisper();
            if (rnd > 0.90) { document.body.classList.add('rgb-split'); setTimeout(() => document.body.classList.remove('rgb-split'), 100); }
            if (rnd > 0.96) { const burn = document.getElementById('burn-effect'); burn.style.opacity = '1'; setTimeout(() => burn.style.opacity = '0', 200); }
            if (rnd > 0.98) { document.body.classList.add('distort'); setTimeout(() => document.body.classList.remove('distort'), 60); }
            if (rnd > 0.99) { document.body.style.opacity = "0.1"; setTimeout(() => document.body.style.opacity = "1", 300); }
        }, 120);

        setInterval(() => {
            const title = document.getElementById('main-title');
            let offX = (Math.random()-0.5)*10;
            let offY = (Math.random()-0.5)*10;

            if (isFinalPhase) {
                const rect = title.getBoundingClientRect();
                const titleCenterX = rect.left + rect.width / 2;
                const titleCenterY = rect.top + rect.height / 2;
                
                const distX = mouseX - titleCenterX;
                const distY = mouseY - titleCenterY;
                const dist = Math.sqrt(distX*distX + distY*distY);
                
                const repelRadius = 300; 
                
                if (dist < repelRadius) {
                    const angle = Math.atan2(distY, distX);
                    const force = (repelRadius - dist) * 0.5; 
                    
                    evasionX -= Math.cos(angle) * force;
                    evasionY -= Math.sin(angle) * force;
                }
                
                evasionX *= 0.9;
                evasionY *= 0.9;
                
                offX += evasionX;
                offY += evasionY;
            }

            title.style.transform = `scaleX(0.8) translate(${offX}px, ${offY}px)`;
            title.style.textShadow = `${15 + offX}px ${15 + offY}px 0px rgba(0,0,0,0.2)`;
            
            if (Math.random() > 0.9) {
                title.style.letterSpacing = (Math.random() * -0.3 - 0.1) + "em";
            } else {
                title.style.letterSpacing = "-0.07em";
            }
        }, 50);
      </script>
</body>
</html>

